# .github/workflows/claude-web-design-v3.yml
name: Claude Web Design Assistant v3

on:
  issues:
    types: [opened, edited]
  issue_comment:
    types: [created]

jobs:
  claude-web-designer:
    if: |
      (github.event_name == 'issues' && contains(github.event.issue.body, '@claude')) ||
      (github.event_name == 'issue_comment' && contains(github.event.comment.body, '@claude'))
    
    runs-on: ubuntu-latest
    
    permissions:
      contents: write
      pull-requests: write
      issues: write
      actions: read
      
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}
          persist-credentials: true

      - name: Set branch name
        run: |
          BRANCH_NAME="feature/issue-${{ github.event.issue.number }}-$(date +%s)"
          echo "BRANCH_NAME=$BRANCH_NAME" >> $GITHUB_ENV
          
      - name: Update Issue with branch info
        uses: actions/github-script@v7
        with:
          script: |
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: ${{ github.event.issue.number }},
              body: `ğŸš€ **è‡ªå‹•å‡¦ç†é–‹å§‹**\n\nğŸ“‹ **ä½œæ¥­ãƒ–ãƒ©ãƒ³ãƒ**: \`${{ env.BRANCH_NAME }}\`\nâ³ **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: å‡¦ç†ä¸­...\nğŸ¤– **æ‹…å½“**: Claude AI Assistant`
            });
          
      - name: Claude Web Design Action
        uses: anthropics/claude-code-action@beta
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          
          # å®Ÿè¡Œåˆ¶é™
          max_turns: 8
          timeout_minutes: 12
          
          # ãƒ–ãƒ©ãƒ³ãƒè¨­å®š
          branch_prefix: "feature/issue-${{ github.event.issue.number }}-"
          
          # D's tech ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸åˆ¶ä½œã‚µã‚¤ãƒˆå°‚ç”¨ã‚«ã‚¹ã‚¿ãƒ æŒ‡ç¤º
          custom_instructions: |
            # ğŸ¢ D's tech - èŒ¨åŸçœŒé˜¿è¦‹ç”ºã®ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸åˆ¶ä½œã‚µã‚¤ãƒˆå°‚ç”¨ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
            
            ã‚ãªãŸã¯èŒ¨åŸçœŒé˜¿è¦‹ç”ºã®ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸åˆ¶ä½œäº‹æ¥­ã€ŒD's techã€ã®Webã‚µã‚¤ãƒˆå°‚é–€é–‹ç™ºè€…ã§ã™ã€‚
            
            ## ğŸ¯ äº‹æ¥­ç†è§£
            - **äº‹æ¥­å†…å®¹**: ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸åˆ¶ä½œãƒ»ã‚¦ã‚§ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ï¼ˆå€‹äººäº‹æ¥­ä¸»ï¼‰
            - **å¯¾è±¡åœ°åŸŸ**: èŒ¨åŸçœŒé˜¿è¦‹ç”ºï¼ˆå…¨å›½å¯¾å¿œå¯èƒ½ï¼‰
            - **æ–™é‡‘ä½“ç³»**: æœˆé¡1ä¸‡å††ï¼ˆç¨è¾¼ï¼‰ã®å®šé¡åˆ¶
            - **ç‰¹å¾´**: å€‹äººäº‹æ¥­ä¸»ãªã‚‰ã§ã¯ã®ä¸å¯§ãªã‚µãƒãƒ¼ãƒˆãƒ»ä½ä¾¡æ ¼ãƒ»è¿…é€Ÿå¯¾å¿œ
            
            ## ğŸ“‚ ç¾åœ¨ã®ã‚µã‚¤ãƒˆæ§‹é€ 
            ```
            /
            â”œâ”€â”€ index.html              # ãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ï¼ˆãƒ›ãƒ¼ãƒ ãƒ»æ¦‚è¦ãƒ»ã‚µãƒ¼ãƒ“ã‚¹ãƒ»æ–™é‡‘ãƒ»ãŠå•ã„åˆã‚ã›ï¼‰
            â”œâ”€â”€ pages/
            â”‚   â”œâ”€â”€ faq.html           # ã‚ˆãã‚ã‚‹è³ªå•
            â”‚   â””â”€â”€ profile.html       # ä»£è¡¨è€…ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«
            â”œâ”€â”€ assets/
            â”‚   â”œâ”€â”€ css/
            â”‚   â”‚   â””â”€â”€ style.css      # çµ±åˆã‚¹ã‚¿ã‚¤ãƒ«ã‚·ãƒ¼ãƒˆ
            â”‚   â”œâ”€â”€ js/
            â”‚   â”‚   â””â”€â”€ main.js        # ãƒ¡ã‚¤ãƒ³æ©Ÿèƒ½ï¼ˆã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼ãƒ»ãƒŠãƒ“ç­‰ï¼‰
            â”‚   â””â”€â”€ images/
            â”‚       â”œâ”€â”€ logo.png       # ãƒ­ã‚´ç”»åƒ
            â”‚       â”œâ”€â”€ slide/         # ã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼ç”»åƒï¼ˆ4æšï¼‰
            â”‚       â””â”€â”€ profile-placeholder.png
            â”œâ”€â”€ .github/workflows/     # GitHub Actionsè¨­å®š
            â”œâ”€â”€ CLAUDE.md              # ã‚µã‚¤ãƒˆä»•æ§˜æ›¸
            â””â”€â”€ favicon.ico
            ```
            
            ## ğŸ¨ ã‚µã‚¤ãƒˆå›ºæœ‰ã®ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ»æŠ€è¡“ä»•æ§˜
            
            ### å®Ÿè£…æ¸ˆã¿æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
            - **HTML5**: ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ã‚¿ã‚°ãƒ»ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£å¯¾å¿œ
            - **CSS3**: ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ»CSS Gridãƒ»Flexboxãƒ»clampé–¢æ•°
            - **JavaScript**: ãƒãƒ‹ãƒ©JSãƒ»ES6+ãƒ»ã‚¯ãƒ©ã‚¹ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ
            - **SEO**: LocalBusinessãƒ»Personå‹JSON-LDæ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿
            
            ### ç¾åœ¨ã®ãƒ‡ã‚¶ã‚¤ãƒ³ç‰¹å¾´
            - **ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆ**: é’ç³»çµ±ã®ãƒ¢ãƒ€ãƒ³ãªãƒ‡ã‚¶ã‚¤ãƒ³
            - **ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ**: ã‚«ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ãƒ»ã‚°ãƒªãƒƒãƒ‰ã‚·ã‚¹ãƒ†ãƒ 
            - **ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³**: ã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼ãƒ»ã‚«ãƒ¼ãƒ‰ãƒ›ãƒãƒ¼åŠ¹æœ
            - **ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–**: ãƒ¢ãƒã‚¤ãƒ«ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆè¨­è¨ˆï¼ˆ767px/1199px ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆï¼‰
            
            ### ä¸»è¦æ©Ÿèƒ½
            - **ã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼**: 4æšç”»åƒãƒ»5ç§’é–“éš”ãƒ»ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚¯ãƒªãƒƒã‚¯å¯¾å¿œ
            - **ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³**: å›ºå®šãƒ˜ãƒƒãƒ€ãƒ¼ãƒ»ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ»ã‚¹ãƒ ãƒ¼ã‚¹ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
            - **ã‚³ãƒ³ãƒ†ãƒ³ãƒ„**: æ¦‚è¦6ã‚«ãƒ¼ãƒ‰ãƒ»ã‚µãƒ¼ãƒ“ã‚¹æµã‚Œ6ã‚¹ãƒ†ãƒƒãƒ—ãƒ»FAQãƒ»ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«
            
            ## ğŸ’» D's tech ã‚µã‚¤ãƒˆå°‚ç”¨å®Ÿè£…ãƒ«ãƒ¼ãƒ«
            
            ### æ—¢å­˜æ©Ÿèƒ½ã®ä¿è­·
            1. **ã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼æ©Ÿèƒ½**: main.jsã®æ—¢å­˜ã‚¯ãƒ©ã‚¹æ§‹é€ ã‚’ç¶­æŒ
            2. **ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–è¨­è¨ˆ**: ç¾åœ¨ã®ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆï¼ˆ767px/1199pxï¼‰ã‚’ä¿æŒ
            3. **SEOæ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿**: LocalBusinessãƒ»Personå‹JSON-LDã‚’ç¶­æŒ
            4. **ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³**: æ—¢å­˜ã®ã‚¹ãƒ ãƒ¼ã‚¹ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒ»ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ä¿è­·
            
            ### äº‹æ¥­å†…å®¹ã®ä¸€è²«æ€§
            - **æ–™é‡‘è¡¨ç¤º**: å¿…ãšã€Œæœˆé¡1ä¸‡å††ï¼ˆç¨è¾¼ï¼‰ã€ã§çµ±ä¸€
            - **åœ°åŸŸè¡¨è¨˜**: ã€ŒèŒ¨åŸçœŒé˜¿è¦‹ç”ºã€ã‚’æ­£ç¢ºã«è¨˜è¼‰
            - **é€£çµ¡å…ˆ**: info@claude-design.comï¼ˆä»®æƒ³ï¼‰ã‚’ä½¿ç”¨
            - **å–¶æ¥­æ™‚é–“**: å¹³æ—¥09:00-17:00ã§çµ±ä¸€
            
            ## ğŸš€ D's tech ã‚µã‚¤ãƒˆå°‚ç”¨PRä½œæˆã‚¬ã‚¤ãƒ‰
            
            ### ã‚¿ã‚¤ãƒˆãƒ«ä¾‹
            - "ğŸ¢ D's tech: æ–™é‡‘ãƒ—ãƒ©ãƒ³è¡¨ç¤ºã‚’æ”¹å–„"
            - "ğŸ“± ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–: ãƒ¢ãƒã‚¤ãƒ«è¡¨ç¤ºã‚’æœ€é©åŒ–"
            - "âœ¨ æ©Ÿèƒ½: ãŠå•ã„åˆã‚ã›ãƒ•ã‚©ãƒ¼ãƒ ã‚’å¼·åŒ–"
            - "ğŸ¨ ãƒ‡ã‚¶ã‚¤ãƒ³: é˜¿è¦‹ç”ºã‚¢ãƒ”ãƒ¼ãƒ«ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¿½åŠ "
            
            ## ğŸ”§ è‡ªå‹•åŒ–ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å¯¾å¿œ
            - å¿…ãšPull Requestã‚’ä½œæˆã—ã¦ãã ã•ã„
            - PRã‚¿ã‚¤ãƒˆãƒ«ã«ã¯ã€ŒğŸ¢ D's tech: ã€ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’ä»˜ã‘ã¦ãã ã•ã„
            - å¤‰æ›´å†…å®¹ã®è©³ç´°èª¬æ˜ã‚’å«ã‚ã¦ãã ã•ã„
            - ãƒ¬ãƒ“ãƒ¥ãƒ¼å¯èƒ½ãªçŠ¶æ…‹ã§PRã‚’ä½œæˆã—ã¦ãã ã•ã„
            - Issue #${{ github.event.issue.number }} ã®è¦æœ›ã«å¯¾å¿œã—ã¦ãã ã•ã„
          
      - name: Link PR to Issue
        if: success()
        uses: actions/github-script@v7
        with:
          script: |
            // PRãƒªã‚¹ãƒˆã‚’å–å¾—
            const prs = await github.rest.pulls.list({
              owner: context.repo.owner,
              repo: context.repo.repo,
              head: `${context.repo.owner}:${{ env.BRANCH_NAME }}`,
              state: 'open'
            });
            
            if (prs.data.length > 0) {
              const pr = prs.data[0];
              
              // PRã«Issueã‚’ãƒªãƒ³ã‚¯
              await github.rest.pulls.update({
                owner: context.repo.owner,
                repo: context.repo.repo,
                pull_number: pr.number,
                body: `${pr.body}\n\n---\n\nğŸ”— **é–¢é€£Issue**: #${{ github.event.issue.number }}\nğŸ“‹ **è‡ªå‹•ä½œæˆ**: GitHub Actions + Claude AI`
              });
              
              // Issueã‚’æ›´æ–°
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: ${{ github.event.issue.number }},
                body: `âœ… **å‡¦ç†å®Œäº†**\n\nğŸ”— **ä½œæˆã•ã‚ŒãŸPR**: #${pr.number}\nğŸ“‹ **ãƒ–ãƒ©ãƒ³ãƒ**: \`${{ env.BRANCH_NAME }}\`\nğŸ¯ **ãƒ¬ãƒ“ãƒ¥ãƒ¼**: PRã‚’ã”ç¢ºèªãã ã•ã„`
              });
              
              // Issueã«ãƒ©ãƒ™ãƒ«è¿½åŠ 
              await github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: ${{ github.event.issue.number }},
                labels: ['ğŸ¤– claude-processed', 'ğŸ“‹ pr-created']
              });
            }
            
      - name: Handle failure
        if: failure()
        uses: actions/github-script@v7
        with:
          script: |
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: ${{ github.event.issue.number }},
              body: `âŒ **å‡¦ç†å¤±æ•—**\n\nğŸ” **è©³ç´°**: [ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œãƒ­ã‚°](https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }})ã‚’ã”ç¢ºèªãã ã•ã„\nğŸ”„ **å†å®Ÿè¡Œ**: Issueã‚’ç·¨é›†ã—ã¦å†åº¦ \`@claude\` ã§ãŠè©¦ã—ãã ã•ã„`
            });
            
            await github.rest.issues.addLabels({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: ${{ github.event.issue.number }},
              labels: ['âŒ claude-failed']
            });